---
import { Image } from 'astro:assets'
import PageLayout from '../layouts/PageLayout.astro'

const galleries = [
    {
        folder: 'japon',
        name: '日本で',
        photos: [
            { name: 'IMG_5932.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_5933.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_6090.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_6204.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_6291.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'IMG_6306.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'IMG_6390.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_6469.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_6478.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_6523.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_6614.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_6684.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'IMG_6755.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'IMG_6780.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_6840.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_6858.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_6972.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_7103.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'IMG_7183.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_7251.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_7268.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_7272.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_7439.jpg', orientation: 'square', title: 'photo test' },
            { name: 'IMG_7742.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_7855.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_7964.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'IMG_8016.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_8036.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_8184.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_8284.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'IMG_8336.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'MLG_8408.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'MLG_8527.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'MLG_8751.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'MLG_8804.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'MLG_8935.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'MLG_9052.jpg', orientation: 'landscape', title: 'photo test' },
        ]
    },
    {
        folder: 'mariages',
        name: 'mariages',
        photos: [
            { name: '_MLG2670_DxO.jpg', orientation: 'portrait', title: 'photo test' },
            { name: '_MLG3100_DxO.jpg', orientation: 'portrait', title: 'photo test' },
        ]
    },
    {
        folder: 'roller',
        name: 'session roller',
        photos: [
            { name: 'MLG_9306.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'MLG_9333.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'MLG_9393.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'MLG_9396.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'MLG_9508.jpg', orientation: 'portrait', title: 'photo test' },
        ]
    },
    {
        folder: 'misc',
        name: 'un peu de tout',
        photos: [
            { name: '_LG_1205_DxO.jpg', orientation: 'portrait', title: 'photo test' },
            { name: '_LG_1211_DxO.jpg', orientation: 'landscape', title: 'photo test' },
            { name: '_LG_1254_DxO.jpg', orientation: 'portrait', title: 'photo test' },
            { name: '_MLG1459_DxO.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'CPC-theme-tryptique.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'DSCF2001.JPG', orientation: 'square', title: 'photo test' },
            { name: 'DSCF2014.JPG', orientation: 'portrait', title: 'photo test' },
            { name: 'DSCF2222.JPG', orientation: 'square', title: 'photo test' },
            { name: 'DSCF2239.JPG', orientation: 'portrait', title: 'photo test' },
            { name: 'IMG_0694.JPG', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_3553.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_3778.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'IMG_5277-2.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'MLG_9849.jpg', orientation: 'landscape', title: 'photo test' },
            { name: 'MLG_9852.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'MLG_9875.jpg', orientation: 'portrait', title: 'photo test' },
            { name: 'MLG_9916.jpg', orientation: 'landscape', title: 'photo test' },
        ]
    },
]
const photosBaseUrl = import.meta.env.GALLERY_BASE_URL
const title = 'Galerie photo'
---

<PageLayout title={title}>
    <img slot="cover" src="/images/photography-cover.jpg" alt="photo d'un parapluie japonais en feuille de riz, composition abstraite" />
    <div slot="description">
        <p>Sélection de photos que j'ai pu prendre au gré de mes promenades, sur notre sol ou ailleurs, sans but précis ou avec une idée en tête, toujours à la recherche du plaisir de prendre des photos.</p>
        <p>Je travaille sans flash, préférant passer à côté d'un moment plutôt qu'éclairer artificiellement une scène. De manière générale j'évite de trop retoucher un cliché (ex: suppression d'élément, traitement HDR) et me contente d'équilibrer les courbes et les couleurs pour un rendu le plus proche de ce que j'avais en tête lors de la prise de vue. J'évite également de compter sur le crop (élimination de portions d'image) et travaille plutôt la composition dès le déclenchement.</p>
        <p>La majorité de mes clichés sont issus de sorties familiales et ne peuvent donc pas être présentés ici. Je ne désespère pas me donner le temps de marcher de nouveau à la recherche de sujets à photographier ; mettre à jour cette modeste galerie pourrait être le levier nécessaire.</p>
        <p>Matériel utilisé :</p>
        <ul>
            <li>DxO PhotoLab & DxO FilmPack [logiciel de développement]</li>
            <li>compact Fujifilm X100F focale fixe 35mm f2.0</li>
            <li>reflex semi-pro Canon EOS 7D</li>
            <li>objectif Canon 50mm f1.8</li>
            <li>objectif Canon 15-55mm f2.8</li>
            <li>objectif Canon 70-200mm f2.8</li>
        </ul>
    </div>
    {galleries.map(gallery =>
        <section class="gallery-theme">
            <h2>{gallery.name}</h2>
            <div class="gallery">
                {gallery.photos.map(photo =>
                    <Image
                        src={photosBaseUrl.concat(gallery.folder, '/', photo.name)}
                        alt={photo.title}
                        width="600"
                        height="600"
                        loading="lazy"
                        class:list={['photo', photo.orientation]}
                        data-gallery={gallery.folder}
                        data-name={photo.name}
                    />
                )}
            </div>
        </section>
    )}
    <div id="full-image-viewer" class="closed">
        <div>
            <img src="gallery/japon/IMG_6306.jpg" alt="full image" />
            <button data-action="close">fermer</button>
        </div>
    </div>
</PageLayout>

<script is:inline define:vars={{ photosBaseUrl }}>
    const viewer = document.getElementById('full-image-viewer')
    const closeButton = viewer.querySelector('button[data-action="close"]')
    const fullImage = viewer.querySelector('img')
    const photos = document.querySelectorAll('.photo')

    function preventScroll(e) {
        e.preventDefault()
        e.stopPropagation()
        return false
    }

    closeButton.addEventListener('click', () => {
        viewer.classList.add('closed')
        document.querySelector('body').removeEventListener('wheel', preventScroll)
    })

    fullImage.addEventListener('click', event => event.stopPropagation())

    photos.forEach(photo => {
        photo.addEventListener('click', () => {
            fullImage.src = photosBaseUrl.concat(photo.dataset.gallery, '/', photo.dataset.name)
            viewer.classList.remove('closed')

            document.querySelector('body').addEventListener('wheel', preventScroll, { passive: false })
        })
    })

    viewer.addEventListener('click', () => {
        viewer.classList.add('closed')
        document.querySelector('body').removeEventListener('wheel', preventScroll)
    })
</script>

<style>
    .gallery-theme:hover h2::before,
    .gallery-theme:hover h2::after {
        --dot-color: var(--f-med);
    }

    .gallery-theme:hover h2::before {
        color: var(--f-med);
    }

    #full-image-viewer {
        z-index: 3;
        position: fixed;
        top: 0;
        left: 0;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 100vw;
        height: 100vh;
        padding: 40px;
        backdrop-filter: blur(10px);
    }

    #full-image-viewer.closed {
        display: none;
    }

    #full-image-viewer>div {
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: left;
        gap: 4px;
        width: fit-content;
        max-width: 100vw;
        max-height: 100vh;
    }

    #full-image-viewer img {
        ratio: preserve;
        max-width: 100%;
        max-height: calc(100% - 44px);
        object-fit: contain;
        box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.5);
    }

    #full-image-viewer button {
        font-family: var(--menu-font);
        text-transform: uppercase;
        font-size: var(--menu-font-size);
        color: var(--f-high);
        width: fit-content;
        height: 40px;
        padding: 0 1rem 0 0;
        background: none;
        border: none;
        outline: none;
    }

    #full-image-viewer button:hover {
        color: var(--f-med);
    }

    #full-image-viewer button:active {
        color: var(--f-high);
    }

    .gallery {
        margin: 4px var(--galery-extra-spacing) 0;
        display: flex;
        flex-flow: row wrap;
        gap: 4px;
    }

    .photo {
        flex: 1;
        width: auto;
        min-width: 32px;
        height: 160px;
        object-fit: cover;
        border-radius: var(--border-radius-small);
        overflow: hidden;
        transition: transform var(--transition-duration);
    }

    .photo:hover {
        transform: scale(1.10);
    }

    .landscape {
        aspect-ratio: 3 / 2;
    }

    .portrait {
        aspect-ratio: 2 / 3;
    }

    .square {
        aspect-ratio: 1 / 1;
    }
</style>
